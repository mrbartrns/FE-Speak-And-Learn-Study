**참고 레퍼런스 꼭 달아주세요.**

# 🔗 참고자료

## 도서

- <HTTP 완벽가이드> - 11장 클라이언트 식별과 쿠키

## Docs

- 위키백과 / "HTTP 쿠키"(https://ko.wikipedia.org/wiki/HTTP_%EC%BF%A0%ED%82%A4)
- MDN / "HTTP 쿠키"(https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies)
- JAVASCRIPT.INFO / 쿠키와 document.cookie(https://ko.javascript.info/cookie)
- MDN / Web Storage API(https://developer.mozilla.org/ko/docs/Web/API/Web_Storage_API)

## 포스팅

- "브라우저 싸움에 등 터지는 개발자들을 위한 HTTP쿠키와 톰캣 쿠키 프로세서 이야기"(https://meetup.toast.com/posts/209) / NHN Cloud Meetup!
- "쿠키 및 보안"(https://humanwhocodes.com/blog/2009/05/12/cookies-and-security/)
- "서드 파티 쿠키를 제한하면 디지털 시장에 생기는 일"(https://www.openads.co.kr/content/contentDetail?contsId=6980)
- "서드파티? 퍼스트파티? 그럼 세컨드파티도 있나요?"(https://www.clien.net/service/board/kin/8099524)
- "쿠키(Cookie), 세션(Session) 특징 및 차이"(https://hahahoho5915.tistory.com/32)
- "CSRF attack"(https://www.imperva.com/learn/application-security/csrf-cross-site-request-forgery/) / Imperva
- "크로스 사이트 스크립팅의 정의 및 공격 유형"(https://nordvpn.com/ko/blog/xss-attack/) / nordVPN
- "브라우저 쿠키와 SameSite 속성"(https://seob.dev/posts/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EC%BF%A0%ED%82%A4%EC%99%80-SameSite-%EC%86%8D%EC%84%B1/) / 이현섭님(토스페이먼츠) 블로그

## 유튜브

- "디토의 웹 스토리지 & 쿠키"(https://www.youtube.com/watch?v=-4ZsGy1LOiE) / 우테코 10분 테코톡

- "세션VS 토큰! JWT가 뭔가요?"(https://www.youtube.com/watch?v=1QiOXWEbqYQ&list=PL8gIGgRPUURV9t8U2bDHbHOETBb3Eclzc&index=84) / 얄팍한 코딩사전

- "세션,쿠키로 로그인을 어떻게 유지시키는가?"(https://www.youtube.com/watch?v=cWUtMHTKdj0&list=PL8gIGgRPUURV9t8U2bDHbHOETBb3Eclzc&index=85&t=21s) / 코드없는 프로그래밍

---

# 예상질문 및 답변

# ❓ 쿠키란 무엇인가요?

브라우저에 저장되는 최대 4KB 작은 크기의 문자열로 key-value 쌍으로 구성됩니다. 쿠키는 브라우저에 저장되는 값이지만 서버에서 사용됩니다. 그래서 보통 서버에서 생성하여 브라우저에 전달합니다.

쿠키는 **웹사이트 방문자의 행동(상태) 데이터**라고 할 수 있는데, 클라이언트와 서버 간 HTTP 요청과 응답 사이에서 **서버가 클라이언트(사용자)를 식별하기 위한 수단**으로 사용될 수 있습니다.

## 이름의 유래, 등장배경

루 몬툴리가 유닉스 프로그래머들이 사용하는 '매직쿠키'라는 용어에서 영감을 얻어 이름지었습니다. 1994년 당시, 루 몬툴리는 넷스케이프에서 근무하고 있었는데, 전자상거래 앱을 개발하고 있었습니다. 넷스케이프는 방문했던 사용자인지 아닌지를 구분하기 위해 **각 사용자의 상태를 저장할 수 있는 방법**이 무엇인지 고민하였는데, 쿠키는 이 문제를 해결할 수 있었습니다.

**왜 사용자의 상태를 저장할 수 없었나요?** → HTTP 프로토콜의 매 연결(요청과 응답)은 일회성이고 독립적으로 처리됩니다. 만약 어떤 정보를 HTTP 프로토콜로 계속 요청과 응답을 주고받아야 한다면 매우 번거롭고 웹 로딩을 느리게 만들 수 있습니다. 그래서 그런 번거로움을 쿠키와 세션으로 해결할 수 있습니다.

## 특징

1. 쿠키는 넷스케이프가 최초로 개발했지만 지금은 모든 브라우저가 지원합니다.

2. 쿠키는 서버에서 사용됩니다.

3. 쿠키는 **만료기간에 따라서** 2가지 종류로 나눌 수 있습니다.

   1. 세션 쿠키(session cookie)

      - 임시 쿠키, 브라우저를 닫으면 삭제됩니다. `Expires` 나 `Max-age` 속성이 없는 쿠키입니다.

   2. 지속(영구) 쿠키(persistent cookie)

      - 브라우저를 닫거나 컴퓨터를 재시작해도 남아있습니다. 보통 사용자가 주기적으로 방문하는 웹사이트에 대한 설정 정보나 로그인 이름을 유지하려고 사용합니다. `Expires` 나 `Max-age`라는 속성으로 만료기간을 정할 수 있습니다.

        **Expires와 Max-age가 모두 존재한다면 어떻게 되나요?** → 쿠키 버전에 따라 다른데, RFC6265 버전의 쿠키라면 Expires는 완전 무시됩니다. → **RFC6265 버전이 무엇인가요? or 다른 쿠키 버전은 무엇이 있나요?** → (여기까지 꼬리질문이 올 수도 있을 것 같습니다. 피해가시거나 참고 포스팅 <NHN Cloud Meetup! / "브라우저 싸움에 등 터지는 개발자들을 위한 HTTP쿠키와 톰캣 쿠키 프로세서 이야기"> 를 읽어보신다면 대답을 잘 하실 수 있을 것 같습니다.)

4. 쿠키는 여러가지 선택 속성을 가질 수 있습니다.

   - 세션쿠키로 만들 것인지 지속쿠키로 만들 것인지 만료기간을 추가할 수도 있고 쿠키의 범위를 한정지을 수도 있습니다.

     **쿠키의 범위를 어떻게 한정지을 수 있나요?** → HTTP 요청을 보낼 때, 쿠키는 서버 도메인과 일치하는 쿠키만 보내도록 되어있습니다. domain을 설정하여 특정 도메인을 지정할 수 있습니다. 그리고 path 속성을 사용하여 특정 경로로 제한할 수도 있습니다. `HttpOnly`라는 플래그를 설정해서 보안을 강화할 수도 있는데, 이것은 자바스크립트로 쿠키를 조작(XSS 공격)하지 못하도록 할 수 있습니다.

5. 쿠키는 **발행한 도메인에 따라서** 2가지 종류로 나눌 수 있습니다.

   1. 퍼스트 파티 쿠키

      - 웹사이트 소유자가 발행한 쿠키입니다. 서브 도메인이 발행한 쿠키도 포함합니다.

        **서브도메인?** → https://m.naver.com/ 같은 것들

   2. 서드 파티 쿠키

      - 웹사이트 소유자가 아닌 제 3자가 활용하는 쿠키입니다. 이러한 서드 파티 쿠키를 사용해서 사용자들의 행동을 파악하고 관심사를 추적하여 데이터를 수집할 수 있는데, **개인 정보 보호** 로 인해 대중적인 브라우저는 서드 파티 쿠키를 제한하고 있습니다. 이미 사파리와 파이어폭스는 서드 파티 쿠키를 제한했고, 크롬도 고려하고 있습니다.

      **세컨드 파티 쿠키는 없나요?** → 예전에는 어떤 회사의 자회사 정도 되는 위치의 회사들이 발행한 쿠키를 세컨드 쿠키라고 했다고 알고 있습니다. 요즘은 의미가 많이 퇴색되어 서드파티로 통합해서 부른다는 정도로만 알고 있습니다.

6. HTTP 요청 시 Set-Cookie라는 HTTP 헤더에 기술되어 서버에 전송됩니다. **쿠키는 기본적으로 모든 쿠키를 헤더에 담아 보냅니다. 하지만 브라우저 제조사들은 쿠키가 생성된 서버로만 전송되도록 합니다.(이 부분이 확실한지 잘 모르겠네요)** 쿠키를 생성한 서버와 관련없는 도메인을 가진 쿠키는 보안상 저장되지 않습니다.

7. 쿠키의 버전은 현재 크게 2가지로 나눌 수 있습니다.

   1. 레거시 쿠키
   2. RFC 6265

   → 이 부분은 꼬리 질문으로 탈탈 털릴 수 있을 것 같습니다... 버전에 대해서는 아예 생략 하시거나, 참고 포스팅 <NHN Cloud Meetup! / "브라우저 싸움에 등 터지는 개발자들을 위한 HTTP쿠키와 톰캣 쿠키 프로세서 이야기"> 를 읽어보시면 잘 대응하실 수 있을 것 같습니다.

## 쿠키의 문제점

1. 트래픽

   - 쿠키는 요청 시 자동으로 Headers에 전송됩니다. 쿠키에 전송될 데이터가 많다면 요청과 응답 속도가 느려질 수 있습니다.

2. 쿠키 조작 및 탈취 가능성(XSS)

   - 쿠키는 브라우저에 저장되는 데이터입니다. 그래서 사용자가 직접 쿠키를 조작할 수도 있고 다른 누군가가 조작할 수도 있습니다. 그래서 민감한 정보를 쿠키에 저장하는 것은 좋지 않습니다.

     → 쿠키에 HttpOnly 옵션을 적용시켜 자바스크립트의 접근을 막을 수 있습니다.

3. 사용자의 권한을 이용한 공격(CSRF)

   → 쿠키에 SameSite 옵션을 적용하여 예방할 수 있습니다.

## ➕ 추가적으로 생각해볼 질문들

- 쿠키에는 어떤 것을 저장하면 좋을까요?

  → 아이디 자동완성, n일 동안 보지 않기, 로그인하지 않은 상태의 장바구니 등 **조작되거나 가로채여도 큰 일은 일어나지 않을 정보들**이면 좋을 것 같습니다.

---

# ❓ 쿠키와 세션의 차이

## 세션은 무엇인가요?

클라이언트의 상태를 저장하기 위해서 데이터를 서버에 저장할 수도 있습니다. 서버의 저장소가 세션입니다. 사실 쿠키와 세션을 완전히 나눠서 말할 수는 없는 것 같습니다. 여기서 말하는 세션은 서버에 저장되는 쿠키입니다.

## 쿠키와의 비교

1. 보안
   - 세션은 서버에 저장되기 때문에 보안상 더 안전합니다.
2. 리소스
   - 쿠키는 사용자의 브라우저에만 저장되지만 모든 사용자의 데이터가 세션에만 저장된다면 매우 많은 사용자가 동시 접속할 경우 서버에 대한 부하가 크게 발생합니다.

---

# ❓ 웹 스토리지에 대해서 설명할 수 있나요?

HTML5 에 추가된 스펙으로 브라우저에서 key-value 값 쌍을 쿠키보다 더 직관적으로 저장할 수 있습니다. MDN은 쿠키보다 웹 스토리지를 사용할 것을 권장하고 있습니다.

## 쿠키와의 비교

1. 5MB의 저장용량 (트래픽 문제 해결)
2. 요청 시 Headers에 전송하지 않음 (CSRF 공격)
3. 문자열만 저장하지만 직렬화/역직렬화로 객체 형태로도 저장가능

## 로컬스토리지와 세션스토리지의 비교

1. 기간
   - 로컬스토리지는 사용자가 직접 삭제하거나 자바스크립트를 이용해서 삭제하기 전까지는 영구적으로 남아있습니다.
   - 세션스토리지는 브라우저를 닫으면 삭제됩니다.
2. 범위
   - 세션스토리지는 브라우저의 탭 마다 따로 저장됩니다. 로컬스토리지는 도메인과 브라우저가 동일하다면 유지됩니다.

## 웹 스토리지의 문제점

1. 자바스크립트로 접근 가능하기 때문에 XSS 공격에 취약합니다.
2. 브라우저 간 공유가 되지 않습니다.
3. 세션 스토리지 일 경우 탭 간 공유가 되지 않습니다.
4. 로컬 스토리지 일 경우 만료기간을 설정할 수 없습니다.
5. 로컬 스토리지에 많은 데이터를 저장할 경우 파싱이 느립니다. 그리고 이것은 동기적으로 실행되기 때문에 메인 스레드 블로킹이 될 수 있습니다.

## ➕ 추가적으로 생각해볼 질문들

1. 자바스크립트에서 웹 스토리지 api를 다룰 때 주의해야할 점이 있을까요?

   - 웹 스토리지를 지원하지 않는 브라우저를 고려합니다.
   - 사파리 브라우저에서는 시크릿 모드를 사용하면 웹 스토리지를 사용하면 에러가 납니다. 이 부분을 고려합니다.
   - 없는 key에 접근할 때를 고려합니다.

   등등... 에러 핸들링을 해야하는 부분을 말하면 좋을 것 같습니다.

# ❓ 무엇을 사용하면 좋을지?

## 쿠키와 세션 무엇을 사용해야하나?

명확한 정답이 있기 보다는 적절히 사용하는 것이 좋을 것 같습니다. 저장해야 할 데이터가 무엇인지, 도메인의 성격에 따라 쿠키와 세션을 적절히 사용해서 리소스를 아끼고 웹 페이지의 성능을 향상 시킬 수 있도록 하는 방법을 적절히 잘 찾아봐야 할 것 같습니다.

## 사용 예시

### 쿠키

n일 동안 보지 않기, 비로그인 장바구니 등

### 세션 스토리지

이전 페이지 저장, 이전 스크롤 위치 저장 등

### 로컬 스토리지

사용자 설정 저장, 글 임시 저장 등

### 세션

브라우저에 저장되면 안될 민감한 정보들 (서버에 저장)

# ➕ 그 밖에 예상할 수 있는 꼬리 질문

- 쿠키, 세션, 스토리지에 대한 질문은 '인증과 인가'에 대한 부분으로 확장될 수 있을 것 같습니다. 인증과 인가는 백엔드쪽 질문일 수 있지만 참고자료-유튜브- "세션VS 토큰! JWT가 뭔가요?" 와 "세션,쿠키로 로그인을 어떻게 유지시키는가?" 를 참고해보시면 좋을 것 같습니다.

- CSRF, XSS에 대한 질문이 들어올 수 있을 것 같습니다.
